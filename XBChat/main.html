<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/comm.css">
    <link rel="stylesheet" href="css/main.css">
    <title>XBChat</title>
</head>

<body>
    <div class="all">
        <div class="main">

            <!--leftmenu start-->
            <div class="leftmenu">
                <div class="userinfo">
                    <div class="userinfo_img">
                        <img src="imgs/face.jpg" alt=""></div>
                    <div class="userinfo_name">
                        <span>Name</span>
                    </div>
                </div>

                <div class="search">
                    <img src="imgs/search.png" alt="">
                    <input type="text" placeholder="搜索" />
                </div>


                <div class="tabpanle">
                    <div class="linkgroup">
                        <span class="groupName">工作(1/10)</span>
                        <ul class='grouplist'>
                            <li data-account='100001'>
                                <img src="imgs/Smile.png" alt="name">
                                <span>100001</span>
                            </li>
                            <li data-account='100002'>
                                <img src="imgs/search.png" alt="name">
                                <span>100002</span>
                            </li>
                        </ul>
                    </div>

                </div>


                <div class="setting">
                    <ul>
                        <li>
                            <img src="imgs/set.png" alt="setting">
                        </li>
                        <li>
                            <img src="imgs/Add.png" alt="Add">
                        </li>
                    </ul>
                </div>
            </div>
            <!--leftmenu end-->

            <!--rightcontent start-->
            <div class="right">
                <div class="content">
                    <div class="msgleft">
                        <div class="fl">
                            <img src="imgs/face.jpg" alt="">
                        </div>
                        <div class="content_text fr">
                            <p>qdqwdqwdqwdqwd</p>
                        </div>
                    </div>
                    <div class="msgtime">
                        <i>2015-6-15 16:27</i>
                    </div>
                </div>



                <!--chatwindows start-->
                <div class="chatwindows">
                    <div class="chattool">
                        <ul>
                            <li> <img src="imgs/Smile.png" alt="setting"></li>

                        </ul>
                    </div>

                    <div class="chattext">
                        <textarea name="" id="msgarea" cols="30" rows="8" class="msgarea" placeholder="在此处输入消息"></textarea>
                    </div>

                    <!--  <div class="footbar">
                  <img src="imgs/Skip.png" alt="Send" class="btnimg">
                </div> -->
                </div>

                <!--chatwindows end-->
            </div>
            <!--rightcontent end-->
        </div>
    </div>

    <input type="hidden" id="lastchatAccountid" />
</body>
<script src="http://code.jquery.com/jquery.js"></script>
<script>
    Date.prototype.Format = function (fmt) { //author: meizz 
        var o = {
            "M+": this.getMonth() + 1, //月份 
            "d+": this.getDate(), //日 
            "h+": this.getHours(), //小时 
            "m+": this.getMinutes(), //分 
            "s+": this.getSeconds(), //秒 
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
            "S": this.getMilliseconds() //毫秒 
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

    $(function () {
        $('.groupName').click(function () {
            var $children = $(this).siblings();
            if ($children.is(':hidden')) {
                $children.show();
            } else {
                $children.hide();
            }
        })

        $('.grouplist li').on('click', function (e) {
            //将当前信息保存起来
            var storge = window.localStorage;

            //获取当前选中人的chat记录，显示到当前窗口
            var curaccountid = this.dataset.account;
            var curacc_lastMsginfo = storge.getItem(curaccountid);


            //获取上一个人的chat记录 写入localstorage
            var lastaccountid = $('#lastchatAccountid').val();

            if (curaccountid != lastaccountid) {

                if (lastaccountid != null && lastaccountid != undefined && lastaccountid != "") {
                    //累加新的信息到后面
                    var lastacc_lastMsginfo = storge.getItem(lastaccountid);
                    var curmsgcontent = $('.content').html();
                    storge.setItem(lastaccountid, lastacc_lastMsginfo);
                }

                $('.content').empty().append(curacc_lastMsginfo);
                $('#lastchatAccountid').val(curaccountid);//将当前选中account 存起来
            }

        });
        // 监听键盘组合键
        $(document).keydown(function (oEvent) {
            if (oEvent.keyCode == 13 && oEvent.ctrlKey) {
                var msg = $("#msgarea").val();
                //todo 发送到后台处理

                var time = new Date().Format("yyyy-MM-dd hh:mm");
                var msghtml = '<div class="msgright"><div class="content_text fl"><p>' + msg + '</p></div><div class="fr"><img src="imgs/face.jpg" alt="555"></div></div>';
                msghtml += '<div class="msgtime"><i>' + time + '</i></div>';
                $('.content').append(msghtml);
            }
        });

    });

</script>

</html>